<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>2</storyId>
    <title>Configure Package Metadata and Dependencies</title>
    <status>drafted</status>
    <generatedAt>2025-11-13</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/loqa-audio-bridge/sprint-artifacts/stories/1-2-configure-package-metadata-and-dependencies.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>complete package.json metadata configured</iWant>
    <soThat>the package is properly indexed on npm and dependencies are clear</soThat>
    <tasks>
      - Update package metadata fields: Set description, author "Loqa Labs", license "MIT", repository GitHub URL, keywords array, homepage, bugs URL
      - Configure peer dependencies: Set expo >=52.0.0, expo-modules-core *, react >=18.0.0, react-native >=0.72.0
      - Add development dependencies: typescript ^5.3.0, @types/react ^18.0.0, eslint ^8.0.0, prettier ^3.0.0
      - Configure package scripts: Add "build": "tsc", "lint": "eslint .", "test": "jest"
      - Validate complete package.json: Verify JSON syntax, required fields, semantic versioning
    </tasks>
  </story>

  <acceptanceCriteria>
    1. Package Metadata Fields: package.json includes description, author "Loqa Labs", license "MIT", repository GitHub URL, keywords ["expo", "react-native", "audio", "streaming", "vad", "microphone"], homepage, bugs URL
    2. Peer Dependencies Configuration: peerDependencies set to expo >=52.0.0, expo-modules-core *, react >=18.0.0, react-native >=0.72.0
    3. Development Dependencies: devDependencies include typescript ^5.3.0, @types/react ^18.0.0, eslint ^8.0.0, prettier ^3.0.0
    4. Package Scripts: scripts section includes "build": "tsc", "lint": "eslint .", "test": "jest"
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/loqa-audio-bridge/PRD.md</path>
        <title>@loqalabs/loqa-audio-bridge v0.3.0 - Product Requirements Document</title>
        <section>MVP - Proper Expo Module Scaffolding</section>
        <snippet>Package must be published to npm registry as @loqalabs/loqa-audio-bridge with proper metadata, semantic versioning (v0.3.0 initial release), and clear peer dependencies. Installation via: npx expo install @loqalabs/loqa-audio-bridge.</snippet>
      </doc>
      <doc>
        <path>docs/loqa-audio-bridge/architecture.md</path>
        <title>Architecture Document</title>
        <section>Decision 2: Version Strategy & Compatibility</section>
        <snippet>Single version with broad peer dependencies. Configuration: expo >=52.0.0, react >=18.0.0, react-native >=0.72.0. Rationale: Expo 52+ provides stable Modules API, React Native 0.72+ covers 95% of active projects. Use semantic versioning for peerDependencies (>= for minimum versions), exact versions for devDependencies to ensure reproducible builds.</snippet>
      </doc>
      <doc>
        <path>docs/loqa-audio-bridge/sprint-artifacts/stories/1-1-generate-module-scaffolding-with-create-expo-module.md</path>
        <title>Story 1.1 Context</title>
        <section>Learnings from Previous Story</section>
        <snippet>Story 1.1 created package.json base scaffolding via create-expo-module. This story enhances that with production-grade metadata. Files created: package.json (to be enhanced), expo-module.config.json, LoqaAudioBridge.podspec, android/build.gradle.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>package.json</path>
        <kind>npm package manifest</kind>
        <symbol>package.json from Story 1.1</symbol>
        <lines>entire file</lines>
        <reason>Base package.json generated by create-expo-module in Story 1.1 - to be enhanced with metadata</reason>
      </artifact>
    </code>
    <dependencies>
      <node>
        <peerDependencies>
          <expo>>=52.0.0</expo>
          <expo-modules-core>*</expo-modules-core>
          <react>>=18.0.0</react>
          <react-native>>=0.72.0</react-native>
        </peerDependencies>
        <devDependencies>
          <typescript>^5.3.0</typescript>
          <types-react>^18.0.0</types-react>
          <eslint>^8.0.0</eslint>
          <prettier>^3.0.0</prettier>
        </devDependencies>
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    - Semantic versioning for peer dependencies: Use >= to specify minimum supported versions, allows users to use newer versions without conflicts
    - Exact versions for dev dependencies: Use ^ for dev dependencies to ensure reproducible builds across development environments
    - Package naming: Must maintain "@loqalabs/loqa-audio-bridge" from Story 1.1, scoped package requires publishConfig.access: "public" (added in Epic 5)
    - Build script connection: Story 1.2 adds "build": "tsc" to package.json, Story 1.3 will configure tsconfig.json that tsc command will use
    - Keywords for npm discoverability: Must include ["expo", "react-native", "audio", "streaming", "vad", "microphone"] for proper npm search indexing
  </constraints>

  <interfaces>
    <interface>
      <name>package.json</name>
      <kind>npm package manifest</kind>
      <signature>JSON with name, version, description, author, license, repository, keywords, peerDependencies, devDependencies, scripts</signature>
      <path>package.json (root of module)</path>
    </interface>
    <interface>
      <name>npm pkg command</name>
      <kind>npm CLI</kind>
      <signature>npm pkg get [field] - retrieve package.json fields for validation</signature>
      <path>External tool - npm CLI</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Validation-focused testing: Verify package.json validates against npm schema. Test all peer dependencies resolve with npm install --dry-run. Verify scripts execute without errors. Validate JSON syntax with npm pkg get command. No unit tests required - validation is schema and dependency resolution checking.
    </standards>
    <locations>
      - Module root: package.json
      - Validation can use npm commands: npm pkg get, npm install --dry-run
    </locations>
    <ideas>
      AC#1: Validate package metadata - Test: Parse package.json and verify all metadata fields present (description, author, license, repository, keywords, homepage, bugs)
      AC#2: Validate peer dependencies - Test: Verify peerDependencies includes expo >=52.0.0, expo-modules-core *, react >=18.0.0, react-native >=0.72.0 with correct version ranges
      AC#3: Validate dev dependencies - Test: Verify devDependencies includes typescript ^5.3.0, @types/react ^18.0.0, eslint ^8.0.0, prettier ^3.0.0
      AC#4: Validate package scripts - Test: Verify scripts section includes "build": "tsc", "lint": "eslint .", "test": "jest"
      Additional: Test dependency resolution - Run npm install --dry-run to verify all dependencies resolve without conflicts
    </ideas>
  </tests>
</story-context>
